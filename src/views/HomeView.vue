<script setup>
import { ref, watch } from 'vue';
import { useRouteStore } from '../stores/routeStore.js';
import { useMotions, useMotion } from '@vueuse/motion';
import { Motions } from '../utils/motions.js';
import Button from '../components/Button.vue';
import DownloadIcon from '../components/SVGs/DownloadIcon.vue';

const routeStore = useRouteStore();

const heroContent = ref(null);
const heroLine = ref(null);
const navLine = ref(null);
const navItems = ref([]);

const heroContentMotion = useMotion(heroContent, Motions.directives['fade-slide-right']);
const heroLineMotion = useMotion(heroLine, Motions.directives['fade-in-scalex']);
const navLineMotion = useMotion(navLine, Motions.directives['fade-in-scalex']);
const navItemMotions = ref([]);

watch(
    () => routeStore.isLeaving,
    (newVal) => {
        if (newVal) {
            // The fix was janky but adding a different motion from the directive ("...-leave") works
            navItemMotions.value = navItems.value.map((el) => {
                if (!el) return null;
                return useMotion(el, Motions.directives['fade-slide-left-leave']);
            });

            heroContentMotion.set('leave');
            heroLineMotion.set('leave');
            navLineMotion.set('leave');

            navItemMotions.value.reverse().forEach((motion, i) => {
                setTimeout(() => {
                    motion.set('leave');
                }, 100 * i);
            });
        }
    },
);
</script>

<template>
    <div class="home-container">
        <div class="hero-content" ref="heroContent" v-motion-fade-slide-right>
            <h3>Hi ðŸ‘‹, my name is</h3>
            <h1>
                Michael
                <span> Green </span>
            </h1>
            <hr class="hero-line" ref="heroLine" v-motion-fade-in-scalex />
            <h2>Full-Stack Developer</h2>
            <p>
                Hello, I am a software engineer with a passion for solving problems. I am writing this in normal a a
                english now.
            </p>
            <div class="cta">
                <Button
                    :onClick="
                        () => {
                            routeStore.toRoute('contact');
                        }
                    "
                    text="Contact"
                    preset="primary primary-accent"
                />
                <a href="files/blank-resume.pdf" download="files/blank-resume.pdf">
                    <Button text="Resume/CV" :iconRight="DownloadIcon" preset="primary" />
                </a>
            </div>
        </div>
        <div class="site-nav">
            <hr class="nav-line" ref="navLine" v-motion-fade-in-scalex />
            <div
                v-for="(route, key, i) in routeStore.routes"
                :key="key"
                v-motion-fade-slide-left
                :delay="100 * i"
                :ref="
                    (el) => {
                        if (el) navItems[i] = el;
                    }
                "
            >
                <Button
                    v-if="key !== 'home'"
                    :onClick="
                        () => {
                            routeStore.toRoute(key);
                        }
                    "
                    :text="route.meta.title"
                    :iconLeft="route.meta.icon"
                    :iconLeftFill="route.meta.iconFill"
                    preset="secondary"
                />
            </div>
        </div>
    </div>
</template>

<style lang="scss" scoped>
.home-container {
    font-size: clamp(10px, 4vw, 16px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    flex-grow: 1;
    padding: 0 $size-4;
    max-width: 400px;
    margin: 0 auto;
    gap: $size-17;
    color: $color-text-primary;

    .hero-content {
        display: flex;
        flex-direction: column;
        gap: $size-2;

        h1,
        h2,
        h3,
        p {
            margin: 0;
        }

        h1 {
            font-size: 5.1em;
            line-height: 0.8ch;
            padding-bottom: $size-1;

            span {
                margin-left: 1.4em;

                @include theme-dark {
                    color: $color-primary-light;
                }

                @include theme-light {
                    color: $color-primary;
                }
            }
        }

        h2,
        p {
            text-align: center;
        }

        h2 {
            font-size: 1.9em;
            width: fit-content;
            margin: 0 auto;
        }

        h3 {
            margin: 0 2px $size-2;
        }

        p {
            font-size: 1.1em;
            max-width: 45ch;
            margin: 0 auto;
        }

        .hero-line {
            border: 0;
            width: 95%;
            margin: 0 auto $size-2;
            height: 1px;

            @include theme-dark {
                background-color: $color-gray6;
            }

            @include theme-light {
                background-color: $color-gray5;
            }
        }

        .cta {
            font-size: 1.1em;
            display: flex;
            justify-content: center;
            gap: $size-4;
            margin-top: $size-2;

            :deep(button) {
                font-weight: 400;
            }
        }
    }

    .site-nav {
        display: none;
        gap: $size-4;
        align-self: flex-end;
        justify-content: flex-end;
        align-items: center;
        flex-wrap: wrap-reverse;
        width: 80%;

        .nav-line {
            border: 0;
            height: 1px;
            flex-grow: 1;

            @include theme-dark {
                background-color: $color-gray6;
            }

            @include theme-light {
                background-color: $color-primary-darker;
            }
        }

        :deep(button) {
            font-size: 1.2em;
            padding: 0 $size-1;

            &::after {
                height: 2px;
            }
        }
    }

    @include bp-custom-min(612) {
        max-width: 100vw;

        h1 {
            font-size: clamp(5.1em, 12vw, 5.5em) !important;
            line-height: 1ch !important;
            max-width: 100vw !important;
            margin: 0 auto !important;
            padding-bottom: $size-1 !important;

            span {
                margin-left: 0 !important;
            }
        }

        h3 {
            font-size: 1.25em !important;
            margin: 0 2px 0 !important;
        }
    }

    @include bp-custom-min(750) {
        padding: 0 $size-11;
    }

    @include bp-md-tablet {
        align-items: flex-start;
        padding: 0 $size-12;

        h1 {
            padding: 0 !important;
        }

        h2,
        p {
            margin: 0 !important;
        }

        p {
            text-align: left !important;
        }

        .hero-line {
            display: none;
        }

        .cta {
            justify-content: flex-start !important;
        }

        .site-nav {
            display: flex;
        }
    }

    @include bp-lg-laptop {
        max-width: 1200px;
        margin: 0 auto;
    }

    @include bp-xl-desktop {
        font-size: 1.2em;
        max-width: 1600px;
    }
}
</style>
